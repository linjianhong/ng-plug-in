"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t,e,n){function o(t){return t.replace(/-(\w)/g,function(t,e){return e.toUpperCase()})}function a(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})}function i(t){if(!t)return!1;var e=t.split("/"),n=a(o("page-"+e.join("-")));return c.find(function(e){return e.param.path==t||e.name==n||e.componentName==n})}var r=t.module("dj.router.frame",["ngAnimate","dj.router.state"]),s=r.component,c=[];r.component=function(t,e){var n=a(t);return c.push({name:t,componentName:n,param:e}),s(o(n),e)},function(){var t,e;r.run(["$rootScope","$q",function(n,o){t=function(){function t(t){this.state=t,this.visible=!1,this.fitstShow=!0,this.component=i(t.path)}return t.prototype={show:function(){this.visible=!0,this.fitstShow=!1},hide:function(){this.visible=!1},getData:function(){return this.component&&this.component.param&&this.component.param.pageDatas}},t}(),e={pos:-1,list:[],push:function(t){return this.list.push(t)},clearAfters:function(){return this.list.splice(this.pos+1,99999)},findIndex:function(t){return this.list.findIndex(function(e){return e.state.id==t.id})},onState:function(e,n){var o=this.pos,a=this.findIndex(e);return a<0&&(this.clearAfters(),this.push(new t(e)),a=this.list.length-1),{oldPos:o,newPos:a}},invalidate:function(t){var e=this.list[t.oldPos],n=this.list[t.newPos];return e&&e.hide(),n&&n.show(),this.pos=t.newPos,{oldPage:e,newPage:n}}}}]),r.directive("djFrameHost",["$parse","$compile",function(t,e){return{restrict:"AE",scope:{p:"="},link:function(t,n,o){t.$watch("p",function(o){if(!(o&&o.state&&o.component&&o.component.componentName))return void n.html("");t.state=o.state;var a=o.component.componentName,i="<"+a+' serach="state.search"></'+a+">";n.html(i),e(n.contents())(t)})}}}]),r.component("djFrame",{template:'<dj-frame-host class=" {{$ctrl.hostCss||\'\'}} {{page.component.param.pageCss}}" ng-show="page.visible" p="(page.visible||!page.component.param.autoDestroy)&&page" ng-repeat="page in pageList"></dj-frame-host>',bindings:{hostCss:"@"},controller:["$scope","$rootScope","$q","$element","$timeout",function(t,n,o,a,r){t.pageList=e.list,n.$on("$DjRouteChangeStart",function(t,e,n){i(e.path)||t.preventDefault()}),n.$on("$DjRouteChangeSuccess",function(t,o,a){var i=e.onState(o,a),r=e.list[i.oldPos],s=e.list[i.newPos];n.$broadcast("$DjPageNavgateStart",s,r);var c=e.invalidate(i);n.$broadcast("$DjPageNavgation",{pages:c,changes:i,cache:e})})}]})}()}(angular,window),function(t,e,n){var o,a,i,r=t.module("dj.router.state",[]);o=function(){function t(t,e){e=e||{};var n=Object.keys(e).map(function(t){return t+"="+e[t]}).join("&");return t+(n&&"?"||"")+n}function e(e,n){return location.origin+location.pathname+"#/"+t(e,n)}function n(t){var e=t.match(/#(!)?\/([^\?]+)(\?(.*))?$/)||[],n=e[2];return!!n&&new a(n,o(e[4]))}function o(t){var e={};return t&&t.split("&").map(function(t){t=t.split("="),t[1]&&(e[t[0]]=t[1])}),e}function a(t,e){this.path=t.replace(/^(\s|\/)+|(\s|\/)+$/gm,""),this.search=e,this.id=-1}var i=0;return a.prototype={autoID:function(){this.id=++i},hash:function(){return t(this.path,this.search)},href:function(){return e(this.path,this.search)},equals:function(t){return t&&t.hash&&this.hash()==t.hash()||this.hash()==t}},a.parseHash=n,a.hash=t,a.href=e,a}(),a=function(){var t=function(){this.t=+new Date,this.activeState=null};return t.prototype={getHistoryStateId:function(){return history.state&&history.state.t===this.t&&history.state.id||0},isHistoryStateId:function(){return history.state&&history.state.t===this.t&&history.state.id||0},equalsCurrentState:function(t){return!(!t instanceof o)&&(this.activeState&&t.equals(this.activeState))},goback:function(){history.go(-1)},forward:function(){history.go(1)},go:function(t){location.href=t.href()},push:function(t){this.activeState=t,history.pushState(_defineProperty({t:this.t,id:t.id},"id",t.id),null,t.href())},replace:function(t){this.activeState=t,history.replaceState({t:this.t,id:t.id},null,t.href())}},new t}(),r.factory("DjState",["$rootScope","$q",function(e,n){function r(t,e){return t instanceof o?t:new o(t,e)}return i={pos:-1,list:[],activeEquals:function(t){return this.list[this.pos]&&this.list[this.pos].equals(t)},navToPos:function(t){if(this.pos==t||!this.list[t])return n.reject("无效跳转");var e=this.list[this.pos],o=this.list[t];return this.pos=t,n.when({newState:o,oldState:e})},navToLast:function(){return this.navToPos(this.list.length-1)},checkNavigateTo:function(t){var e=this.list.findIndex(function(e){return e.id==t});return e<0?"error id":e===this.pos?"same pos":e},gotoHistoryPage:function(e){var o=i.checkNavigateTo(e);return t.isNumber(o)?this.navToPos(o):n.reject(o)},appendState:function(t){this.list.splice(this.pos+1,99999),this.list.push(t)}},{hash:o.hash,href:o.href,go:function(t,n){var s=r(t,n),c=o.parseHash(location.href);if(!e.$broadcast("$DjRouteChangeStart",s,c).defaultPrevented)return a.activeState?location.href!=s.href()&&(s.autoID(),a.push(s),i.appendState(s),!0):(s.autoID(),a.replace(s),!0)},goback:function(){a.goback()},forward:function(){a.forward()},replace:function(t,e){var n=r(t,e);n.autoID(),a.replace(n)},replaceSearch:function(t){if(a.activeState){var e=r(a.activeState.path,t);e.autoID(),a.replace(e)}}}}]),r.run(["$rootScope","$location","$q","DjState",function(t,e,n){function r(e){var n=e.newState,o=e.oldState;return t.$broadcast("$DjRouteChangeSuccess",n,o),e}t.$on("$locationChangeStart",function(e,n,a){var i=o.parseHash(n),r=o.parseHash(a);t.$broadcast("$DjRouteChangeStart",i,r).defaultPrevented&&e.preventDefault()}),t.$on("$locationChangeSuccess",function(t,e,s){var c=a.getHistoryStateId();i.gotoHistoryPage(c).then(function(t){return r(t),t}).catch(function(t){if("same pos"==t)return n.reject(t);var s=o.parseHash(e);return s.autoID(),i.appendState(s),i.navToLast().then(function(t){return a.replace(t.newState),r(t),t})})})}])}(angular,window);